name: AveryOS Sovereign Kernel Sync
permissions:
  contents: read # Fixes High-Severity Security Alert #9

on:
  push:
    branches: [ main ] # Real-time trigger on every commit
  schedule:
    - cron: '*/5 * * * *' # Tightened to GitHub's 5-minute minimum limit
  workflow_dispatch:

jobs:
  Sovereign-Sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Acknowledge Root0 Genesis Anchor
        run: |
          echo "Verifying SHA: cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e"
          echo "Status: FullStack Jason Locked"

      - name: Verify Sovereign Runtime Environment
        run: |
          echo "✅ Node.js: $(node --version)"
          echo "✅ npm: $(npm --version)"
          echo "✅ Repo: ${{ github.repository }}"
          echo "✅ Commit: ${{ github.sha }}"
          echo "✅ Branch: ${{ github.ref_name }}"

      - name: Verify Sovereign Codebase Integrity
        run: |
          echo "Verifying critical runtime files..."
          test -f package.json         && echo "✅ package.json present"         || { echo "❌ package.json missing"; exit 1; }
          test -f package-lock.json    && echo "✅ package-lock.json present"    || { echo "❌ package-lock.json missing"; exit 1; }
          test -f next.config.js       && echo "✅ next.config.js present"       || { echo "❌ next.config.js missing"; exit 1; }
          test -f wrangler.toml        && echo "✅ wrangler.toml present"        || { echo "❌ wrangler.toml missing"; exit 1; }
          echo "✅ Sovereign codebase integrity verified."

      - name: Generate Sovereign Mesh Proof Artifacts
        run: node scripts/forgeMeshProofKit.js
